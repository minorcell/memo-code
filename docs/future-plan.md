# memo-cli 未来发展规划

## 1. 项目现状分析

memo-cli 是一个基于 Bun + TypeScript 的 ReAct Agent CLI 工具，具有以下核心特性：

- **多轮对话**：交互式 REPL 与单轮模式（`--once`）
- **工具驱动**：内置 bash/read/write/edit/glob/grep/webfetch/save_memory/todo 等工具，严格遵循 ReAct 协议
- **结构化日志**：JSONL 格式记录完整会话历史，便于调试与审计
- **Token 预算管理**：本地 tiktoken 预估 + LLM usage 对账，支持超限预警
- **架构清晰**：Core/Tools/UI 三层分离，Core 提供纯函数接口，UI 为薄壳

当前代码结构：

- `packages/core`：配置、运行时（Session/Turn）、LLM 适配、工具集装配
- `packages/tools`：内置工具实现与测试
- `packages/ui`：CLI 入口，组装 Core + Tools
- `docs/`：架构与设计文档

## 2. 市场竞品对比

| 产品                         | 类型          | 优势                              | 劣势                              | 与 memo-cli 对比                                      |
| ---------------------------- | ------------- | --------------------------------- | --------------------------------- | ----------------------------------------------------- |
| **LangChain CLI**            | 项目脚手架    | 生态丰富，社区活跃                | 不提供交互式代理，功能单一        | memo-cli 专注于交互式代理，工具更丰富                 |
| **Cursor**                   | AI 代码编辑器 | 强大的代码理解与生成，集成 IDE    | 闭源、商业、专注于代码编辑        | memo-cli 开源、通用性强，可扩展至非代码场景           |
| **ChatGPT Code Interpreter** | 沙箱代码执行  | 易用，OpenAI 生态                 | 仅限于 Python，功能受限，依赖云端 | memo-cli 本地运行，工具可自定义，支持多语言           |
| **OpenInterpreter**          | 开源 CLI      | 允许 LLM 在本地运行代码，类似理念 | 侧重于代码执行，工具集较窄        | memo-cli 工具更全面（文件操作、搜索等），架构更模块化 |
| **MemGPT**                   | 长期记忆代理  | 专注于记忆管理，学术性强          | 应用场景较窄                      | memo-cli 可通过 save_memory 工具扩展记忆，更通用      |

**memo-cli 核心优势**：

1. **协议驱动**：严格的 JSON 协议，确保输出可解析
2. **架构解耦**：Core/Tools/UI 分离，易于扩展新前端（CLI、桌面、Web）
3. **可观察性**：JSONL 日志为调试、监控提供基础
4. **轻量快速**：基于 Bun，启动快，依赖少

**当前不足**：

1. **知名度低**：缺乏宣传与社区
2. **工具安全性**：需要更强的输入校验与隔离（如路径白名单、只读模式）
3. **功能局限**：缺少一些常用工具（时间、环境变量、网络请求增强等）
4. **生态缺失**：插件系统、第三方工具集成尚未实现

## 3. 产品与架构建议

### 3.1 产品定位

**目标**：成为开发者首选的本地 AI 代理框架，兼顾易用性与可扩展性。

- **核心场景**：本地开发辅助（代码审查、文件操作、项目分析）、自动化任务（数据抓取、文档生成）、学习与研究（交互式探索）
- **用户群体**：开发者、技术爱好者、研究人员
- **差异化**：开源、模块化、协议驱动、可观察性强

### 3.2 架构改进

1. **强化 Core 钩子与事件系统**：
    - 完善 `onTurnStart`/`onAction`/`onObservation`/`onFinal` 钩子，支持自定义中间件
    - 提供上下文截断策略接口，支持多种摘要算法（如 LLM 摘要、关键句提取）
    - 抽象历史 sink，支持 stdout、文件、远程服务（如 OpenTelemetry）

2. **工具安全与能力扩展**：
    - 增加路径白名单配置，限制工具可访问目录
    - 提供只读模式，防止意外修改
    - 增加常用工具：`time`（获取时间）、`env`（读取环境变量）、`size`（文件大小）、`hash`（计算哈希）、`curl`（增强网络请求）
    - 统一错误码与提示语，提高用户体验

3. **插件系统设计**：
    - 定义插件接口，允许第三方开发自定义工具
    - 支持动态加载插件（如从 npm 安装）
    - 提供插件市场或官方仓库

4. **配置与依赖管理**：
    - 增强 `~/.memo/config.toml`，支持多环境配置
    - 内置依赖检测（如 ripgrep、curl），提供友好提示
    - 支持模型切换（OpenAI、DeepSeek、本地模型如 Ollama）

### 3.3 功能增强

1. **长期记忆优化**：
    - 扩展 save_memory 工具，支持向量存储与检索
    - 实现会话间记忆共享
    - 提供记忆管理命令（查看、删除、导出）

2. **多模态支持**：
    - 集成图像识别（调用本地模型或云端 API）
    - 支持文件上传与处理（如图片转文字）

3. **协作与共享**：
    - 支持导出会话为 Markdown/PDF
    - 允许分享会话链接（如生成可读的网页版）
    - 团队协作功能（共享配置、工具）

4. **性能与体验**：
    - 优化 token 计数速度，减少延迟
    - 提供进度指示器（长时间工具执行时）
    - 支持流式输出（逐步显示模型思考）

### 3.4 生态扩展

1. **多前端实现**：
    - CLI（现有）：继续优化交互，支持彩色输出、表格渲染
    - 桌面应用（Electron）：提供图形界面，降低非开发者使用门槛
    - Web/REST API：暴露 HTTP 接口，方便集成到其他系统

2. **集成开发环境**：
    - 开发 VS Code 扩展，在编辑器内直接调用 memo-cli
    - 支持 JetBrains IDE 插件

3. **社区建设**：
    - 完善文档（教程、案例、API 参考）
    - 建立 Discord/微信群，收集反馈
    - 举办黑客马拉松，鼓励贡献

## 4. 实施路线图

### 立即执行（本月）

1.  **Codebase Context (Repo Map)**: 实现轻量级 AST 分析，生成仓库结构图，解决 Token 消耗大且易迷失的问题（对标 Aider）。
2.  **External MCP Client**: 实现 MCP 客户端，支持连接外部 MCP Server（如 Postgres, Google Drive），扩展 Agent 能力边界（对标 Claude Code）。
3.  **Git Integration**: 封装 Git 自动化工具，支持 Auto-Commit 和 Undo，增强开发流体验。

### 短期（1-2个月）

1. 补强 Core hook 与事件系统，提供 stdout sink 选项
2. 增加工具安全校验（路径白名单、只读模式）
3. 添加 3-5 个常用工具（time、env、size 等）
4. 完善测试覆盖，CI 自动化
5. 编写入门教程与案例

### 中期（3-6个月）

1. 设计并实现插件系统原型
2. 扩展 save_memory 工具，支持向量存储
3. 开发桌面应用原型（Electron）
4. 支持多模型切换（Ollama 等）
5. 建立社区渠道，收集用户反馈

### 长期（6-12个月）

1. 插件市场建设
2. 多模态支持（图像识别）
3. Web/REST API 实现
4. VS Code 扩展开发
5. 性能优化与大规模测试

## 5. 风险与应对

- **竞争风险**：Cursor 等商业产品功能强大。应对：坚持开源、模块化，吸引开发者社区。
- **安全风险**：工具执行可能带来安全隐患。应对：加强沙箱、权限控制，提供安全指南。
- **技术风险**：LLM 协议变化可能导致兼容性问题。应对：保持协议抽象，支持多版本。
- **社区风险**：项目活跃度不足。应对：定期更新，举办活动，奖励贡献者。

## 6. 总结

memo-cli 已具备良好的架构基础与核心功能，通过聚焦开发者需求、强化安全与扩展性、构建生态社区，有望成为本地 AI 代理领域的重要开源项目。建议按照上述路线图逐步推进，同时保持与用户的紧密沟通，持续迭代。

---

_文档生成时间：2025-12-10_  
_最后更新：2025-12-16_  
_基于代码分析与市场调研_
