# 审批与安全

Memo 默认启用工具审批。模型尝试执行高风险操作时，会先请求你的许可。

## 一、默认审批策略

当前默认策略等价于 `auto`：

- 只读工具：通常自动放行
- 写入工具：需要审批
- 执行工具：需要审批
- Subagent 工具族（`spawn_agent` / `send_input` / `resume_agent` / `wait` / `close_agent`）默认免审批

风险级别由工具名和内置映射共同判定。

## 二、审批选项

在 TUI 审批弹窗中通常有：

- `Allow once`：仅放行本次调用（当前 turn 结束后失效）
- `Allow all session`：当前会话内同指纹请求自动放行
- `Reject`：拒绝

“指纹”由 `工具名 + 参数` 计算；参数变化后通常会再次触发审批。

## 三、`--dangerous` 模式

```bash
memo --dangerous
# 或 memo -d
```

行为：跳过审批，直接执行工具。

适用场景：

- 你已明确操作范围，且愿意自行承担风险。
- 需要高频批量改动，并且会自行审查 diff。

不建议场景：

- 不确定模型将访问哪些文件/命令。
- 当前目录包含敏感数据或关键生产代码。

## 四、Plain 模式与审批

Plain 模式（非 TTY）无法显示交互审批，因此需审批的工具会被默认拒绝。

可选方案：

1. 改用 TUI：`memo`
2. 明确接受风险后使用 `--dangerous`
3. 将任务改成纯只读分析

## 五、安全实践建议

- 先 dry-run：先让模型列出计划改动，再批准写入。
- 执行命令优先读操作：如 `git status`、`ls`、`rg`。
- 明确文件白名单：减少误改范围。
- 敏感目录谨慎使用 `--dangerous`。
