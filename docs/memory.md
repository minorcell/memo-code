# Memory（长期记忆）设计

## 目标

- 为 memo-cli 提供跨 Session 的长期记忆，存储在用户目录（`~/.memo/memory.md`）。
- 在每次 Session 启动时，将 memory 内容随系统提示词注入，让模型可利用用户画像/偏好。
- 提供 `memory` 工具，允许模型在给出最终回答前写入一条极短的摘要。

## 存储

- 路径：`MEMO_HOME` 下的 `memory.md`（默认 `~/.memo/memory.md`）。
- 结构：追加式 Markdown 列表（`- <ISO 时间> <摘要>`）。
- 创建：不存在时自动创建所在目录。

## 注入时机

- `createAgentSession` 启动时读取 `memory.md`，非空则在系统提示词末尾附加「长期记忆」段落。
- memory 内容不可在回答中直接泄露，只作为参考。

## memory 工具

- 名称：`memory`
- 输入：`{"note":"一句极短摘要，≤32 字符"}`，自动清理多余空白/换行并追加到 `memory.md`。
- 使用时机：仅在准备返回 final 之前，如发现可复用的用户画像/习惯/偏好信息可调用一次，避免频繁调用。
- 输出：确认写入的文件路径，失败时返回错误信息。

## 使用建议

- 摘要要短、泛化，避免敏感信息与原文（例：`用户常用中文回答，偏好简洁步骤`）。
- 可后续迭代：重复检测/压缩、清理/导出命令、权限控制（600）。

## 测试覆盖

- memory 工具：输入校验、写入与内容清理。
- 注入：存在 `memory.md` 时系统提示词包含记忆内容。
